<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>โปรแกรมออกแบบเสาเหล็ก (AISC 360-16 LRFD) By : วศ.ธงชาติ อำแดงพิน</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom styles */
        body { font-family: 'Sarabun', sans-serif; }
        .input-group { margin-bottom: 1rem; }
        .input-group label { min-width: 200px; display: inline-block; font-weight: 500; color: #4b5563; margin-bottom: 0.25rem; }
        @media (max-width: 767px) { .input-group label { display: block; min-width: auto; } }
        .input-field { border: 1px solid #d1d5db; padding: 0.5rem; border-radius: 0.375rem; width: 100%; max-width: 250px; }
        .unit-span { color: #6b7280; margin-left: 0.5rem; }
        .result-section { margin-top: 1.5rem; padding: 1.5rem; border: 1px solid #e5e7eb; border-radius: 0.5rem; background-color: #f9fafb; }
        .result-subsection { margin-top: 1rem; padding-top: 1rem; border-top: 1px dashed #d1d5db; }
        .disclaimer {
            margin-top: 2rem;
            padding: 1rem;
            border: 1px solid #facc15; /* Amber-400 border */
            background-color: #fefce8; /* Amber-50 background */
            color: #ca8a04; /* Amber-600 text */
            border-radius: 0.375rem; /* 6px */
            font-size: 0.875rem; /* 14px */
            line-height: 1.25rem; /* 20px */
            display: flex; /* Use flexbox for layout */
            align-items: flex-start; /* Align items to the top */
            gap: 1rem; /* Space between image and text */
        }
        .disclaimer img {
            flex-shrink: 0; /* Prevent image from shrinking */
            width: 100px; /* Set image width */
            height: auto; /* Maintain aspect ratio */
            border-radius: 0.375rem; /* Rounded corners for image */
            object-fit: cover; /* Ensure image covers the area nicely */
        }
        .warning { color: #eab308; font-weight: bold; }
        .error { color: #dc2626; font-weight: bold; }
        .success { color: #16a34a; font-weight: bold; }
        .calculation-button { background-color: #3b82f6; color: white; font-weight: bold; padding: 0.75rem 1.5rem; border-radius: 0.5rem; transition: background-color 0.3s ease; cursor: pointer; }
        .calculation-button:hover { background-color: #2563eb; }
        .result-value { font-weight: bold; color: #1f2937; }
        ul { list-style-position: inside; }
        /* Style for the author name */
        .author-name {
            display: block; /* Make it appear on a new line */
            font-size: 1rem; /* Smaller font size */
            font-weight: normal; /* Normal weight */
            margin-top: 0.25rem; /* Add some space above */
            color: #4b5563; /* Gray-600 */
        }
    </style>
     <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;500;700&display=swap" rel="stylesheet">
</head>
<body class="bg-gray-100 p-4 md:p-8">

    <div class="max-w-4xl mx-auto bg-white p-6 md:p-8 rounded-lg shadow-lg">
        <h1 class="text-2xl md:text-3xl font-bold mb-6 text-center text-blue-700">
            โปรแกรมออกแบบเสาเหล็ก (AISC 360-16 LRFD)
            <span class="author-name">By : วศ.ธงชาติ อำแดงพิน</span>
        </h1>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-4">
            <div>
                <h2 class="text-xl font-semibold mb-3 text-gray-800 border-b pb-2">ข้อมูลทั่วไปและหน้าตัด</h2>
                <div class="input-group">
                    <label for="fy">กำลังคราก (Fy):</label>
                    <div>
                        <input type="number" id="fy" value="345" class="input-field">
                        <span class="unit-span">MPa</span>
                    </div>
                </div>
                <div class="input-group">
                    <label for="E">โมดูลัสยืดหยุ่น (E):</label>
                    <div>
                        <input type="number" id="E" value="200000" class="input-field" readonly>
                        <span class="unit-span">MPa</span>
                    </div>
                </div>
                <div class="input-group">
                    <label for="length">ความยาวเสา (L):</label>
                     <div>
                        <input type="number" id="length" value="5" step="0.1" class="input-field">
                        <span class="unit-span">m</span>
                    </div>
                </div>
                 <div class="input-group">
                    <label for="Kx">ค่า K แกน X (Kx):</label>
                     <div>
                        <input type="number" id="Kx" value="1.0" step="0.1" class="input-field">
                    </div>
                </div>
                 <div class="input-group">
                    <label for="Ky">ค่า K แกน Y (Ky):</label>
                    <div>
                        <input type="number" id="Ky" value="1.0" step="0.1" class="input-field">
                    </div>
                </div>
                 <div class="input-group">
                    <label for="section">เลือกหน้าตัดเหล็ก:</label>
                    <div>
                        <select id="section" class="input-field w-full max-w-xs">
                            </select>
                    </div>
                </div>
            </div>

            <div>
                <h2 class="text-xl font-semibold mb-3 text-gray-800 border-b pb-2">แรงกระทำ (Required Strength)</h2>
                <div class="input-group">
                    <label for="Pu">แรงอัดตามแนวแกน (Pu):</label>
                    <div>
                        <input type="number" id="Pu" value="1000" class="input-field">
                        <span class="unit-span">kN</span>
                    </div>
                </div>
                 <div class="input-group">
                    <label for="Mux">โมเมนต์ดัดรอบแกน X (Mux):</label>
                     <div>
                        <input type="number" id="Mux" value="50" class="input-field">
                        <span class="unit-span">kN·m</span>
                    </div>
                </div>
                 <div class="input-group">
                    <label for="Muy">โมเมนต์ดัดรอบแกน Y (Muy):</label>
                    <div>
                        <input type="number" id="Muy" value="10" class="input-field">
                        <span class="unit-span">kN·m</span>
                    </div>
                </div>
                 <div class="input-group">
                    <label for="Vux">แรงเฉือนแกน Y (Vux):</label>
                     <div>
                        <input type="number" id="Vux" value="100" class="input-field">
                        <span class="unit-span">kN</span>
                     </div>
                     <small class="text-gray-500 block"> (แรงเฉือนที่ทำให้เกิดการดัดรอบแกน X)</small>
                </div>
                <div class="input-group">
                    <label for="Vuy">แรงเฉือนแกน X (Vuy):</label>
                    <div>
                        <input type="number" id="Vuy" value="20" class="input-field">
                        <span class="unit-span">kN</span>
                    </div>
                     <small class="text-gray-500 block"> (แรงเฉือนที่ทำให้เกิดการดัดรอบแกน Y)</small>
                </div>
            </div>
        </div>


        <div class="mt-8 text-center">
            <button onclick="calculateDesign()" class="calculation-button">
                คำนวณการออกแบบ
            </button>
        </div>

        <div id="results" class="result-section hidden">
             <h2 class="text-xl font-semibold mb-4 text-gray-800 border-b pb-2">ผลการคำนวณและตรวจสอบ</h2>
             <div id="output" class="space-y-3 text-sm md:text-base">
                 </div>
        </div>

         <div class="disclaimer">
             <img src="https://placehold.co/100x115/EFEFEF/AAAAAA?text=User+Image+Here"
                  alt="รูปประกอบข้อควรระวัง"
                  onerror="this.onerror=null; this.src='https://placehold.co/100x115/EFEFEF/AAAAAA?text=Image+Not+Found';">
             <div>
                 <p><strong>ข้อควรระวังและข้อจำกัด:</strong></p>
                 <ul class="list-disc list-inside mt-2">
                     <li>โปรแกรมนี้เป็นเครื่องมือช่วยคำนวณเบื้องต้นเพื่อการศึกษาเท่านั้น ไม่สามารถใช้แทนการออกแบบทางวิศวกรรมโดยผู้เชี่ยวชาญได้</li>
                     <li>การคำนวณอ้างอิงตาม AISC 360-16 LRFD โดยใช้หน่วย SI</li>
                     <li><span class="font-bold">ฐานข้อมูลหน้าตัดเหล็ก:</span> สร้างจากไฟล์ CSV ที่ผู้ใช้ให้มา (WF, I-Beam, Channel) จำนวน 118 หน้าตัด ควรตรวจสอบความถูกต้องของข้อมูลกับตารางเหล็กมาตรฐาน</li>
                     <li><span class="font-bold">Plastic Modulus (Z):</span> ค่า Zx, Zy ไม่มีในข้อมูลต้นฉบับ:
                          <ul class="list-disc list-inside ml-4">
                             <li>สำหรับ WF/I-Beam: ประมาณค่า Z ≈ 1.12 * S</li>
                             <li>สำหรับ Channel: ใช้ Z = S (คำนวณ Mn อิงตาม My)</li>
                          </ul>
                     </li>
                     <li><span class="font-bold">Local Buckling:</span> แสดงผลการจำแนกประเภทหน้าตัด แต่ยังไม่ได้นำผลไปลดค่ากำลังรับแรงอัด/แรงดัดสำหรับหน้าตัด Non-compact/Slender อย่างสมบูรณ์</li>
                     <li><span class="font-bold">Flexural Strength (Mn):</span> สำหรับ WF/I-Beam คำนวณโดยสมมติว่าหน้าตัดเป็น Compact และมีการค้ำยันด้านข้างเต็มที่ (Lb=0) ไม่ได้พิจารณา Lateral-Torsional Buckling (LTB). สำหรับ Channel คำนวณ Mn อิงตาม My (Z=S).</li>
                     <li><span class="font-bold">Shear Strength (Vn):</span> คำนวณโดยสมมติค่า Cv = 1.0</li>
                      <li><span class="font-bold">ความเหมาะสมของสูตร:</span> สูตร AISC ที่ใช้ในโปรแกรมนี้เหมาะสำหรับหน้าตัด I-Shape เป็นหลัก การใช้กับ Channel อาจมีข้อจำกัด โดยเฉพาะเรื่อง Local Buckling และการบิดงอ</li>
                     <li>ผู้ใช้งานต้องตรวจสอบความถูกต้อง ความเหมาะสมกับโครงการ และพิจารณาข้อจำกัดเหล่านี้เสมอ</li>
                 </ul>
            </div>
        </div>
    </div>

    <script>
        // --- Steel Section Database (Generated from User Files) ---
        const steelSectionsDatabase = [
            { "name": "Channel-100x50", "Ag": 1192.0, "d": 100.0, "tw": 5.0, "bf": 50.0, "tf": 7.5, "Ix": 1890000.0, "Iy": 269000.0, "rx": 39.8, "ry": 15.0, "Sx": 37800.0, "Sy": 7820.0, "Zx": 37800.0, "Zy": 7820.0 },
            { "name": "Channel-125x65", "Ag": 1711.0, "d": 125.0, "tw": 6.0, "bf": 65.0, "tf": 8.0, "Ix": 4250000.0, "Iy": 655000.0, "rx": 49.9, "ry": 19.6, "Sx": 68000.0, "Sy": 14400.0, "Zx": 68000.0, "Zy": 14400.0 },
            { "name": "Channel-150x75", "Ag": 2371.0, "d": 150.0, "tw": 6.5, "bf": 75.0, "tf": 10.0, "Ix": 8640000.0, "Iy": 1220000.0, "rx": 60.4, "ry": 22.7, "Sx": 115000.0, "Sy": 23600.0, "Zx": 115000.0, "Zy": 23600.0 },
            { "name": "Channel-150x75", "Ag": 3059.0, "d": 150.0, "tw": 9.0, "bf": 75.0, "tf": 12.5, "Ix": 10500000.0, "Iy": 1470000.0, "rx": 58.6, "ry": 21.9, "Sx": 140000.0, "Sy": 28300.0, "Zx": 140000.0, "Zy": 28300.0 },
            { "name": "Channel-180x75", "Ag": 2720.0, "d": 180.0, "tw": 7.0, "bf": 75.0, "tf": 10.5, "Ix": 13800000.0, "Iy": 1370000.0, "rx": 71.3, "ry": 22.4, "Sx": 154000.0, "Sy": 25500.0, "Zx": 154000.0, "Zy": 25500.0 },
            { "name": "Channel-200x70", "Ag": 2692.0, "d": 200.0, "tw": 7.0, "bf": 70.0, "tf": 10.0, "Ix": 16200000.0, "Iy": 1130000.0, "rx": 77.7, "ry": 20.4, "Sx": 162000.0, "Sy": 21800.0, "Zx": 162000.0, "Zy": 21800.0 },
            { "name": "Channel-200x80", "Ag": 3133.0, "d": 200.0, "tw": 7.5, "bf": 80.0, "tf": 11.0, "Ix": 19500000.0, "Iy": 1770000.0, "rx": 78.9, "ry": 23.8, "Sx": 195000.0, "Sy": 30800.0, "Zx": 195000.0, "Zy": 30800.0 },
            { "name": "Channel-200x90", "Ag": 3865.0, "d": 200.0, "tw": 8.0, "bf": 90.0, "tf": 13.5, "Ix": 24900000.0, "Iy": 2860000.0, "rx": 80.3, "ry": 27.2, "Sx": 249000.0, "Sy": 45900.0, "Zx": 249000.0, "Zy": 45900.0 },
            { "name": "Channel-250x90", "Ag": 4407.0, "d": 250.0, "tw": 9.0, "bf": 90.0, "tf": 13.0, "Ix": 41800000.0, "Iy": 3060000.0, "rx": 97.4, "ry": 26.4, "Sx": 335000.0, "Sy": 46500.0, "Zx": 335000.0, "Zy": 46500.0 },
            { "name": "Channel-250x90", "Ag": 5117.0, "d": 250.0, "tw": 11.0, "bf": 90.0, "tf": 14.5, "Ix": 46900000.0, "Iy": 3420000.0, "rx": 95.7, "ry": 25.8, "Sx": 375000.0, "Sy": 51700.0, "Zx": 375000.0, "Zy": 51700.0 },
            { "name": "Channel-300x90", "Ag": 5352.0, "d": 300.0, "tw": 9.0, "bf": 90.0, "tf": 13.0, "Ix": 66800000.0, "Iy": 3530000.0, "rx": 111.8, "ry": 25.7, "Sx": 445000.0, "Sy": 51100.0, "Zx": 445000.0, "Zy": 51100.0 },
            { "name": "Channel-300x90", "Ag": 6062.0, "d": 300.0, "tw": 11.0, "bf": 90.0, "tf": 14.5, "Ix": 74300000.0, "Iy": 3920000.0, "rx": 110.7, "ry": 25.4, "Sx": 496000.0, "Sy": 56700.0, "Zx": 496000.0, "Zy": 56700.0 },
            { "name": "Channel-380x100", "Ag": 7286.0, "d": 380.0, "tw": 10.5, "bf": 100.0, "tf": 16.0, "Ix": 145000000.0, "Iy": 5980000.0, "rx": 141.1, "ry": 28.700000000000003, "Sx": 761000.0, "Sy": 78800.0, "Zx": 761000.0, "Zy": 78800.0 },
            { "name": "Channel-75x40", "Ag": 882.0, "d": 75.0, "tw": 5.0, "bf": 40.0, "tf": 7.0, "Ix": 759000.0, "Iy": 124000.0, "rx": 29.3, "ry": 11.9, "Sx": 20200.0, "Sy": 4540.0, "Zx": 20200.0, "Zy": 4540.0 },
            { "name": "I-Beam-100x75", "Ag": 1290.0, "d": 100.0, "tw": 5.0, "bf": 75.0, "tf": 8.0, "Ix": 2810000.0, "Iy": 473000.0, "rx": 41.4, "ry": 17.0, "Sx": 56200.0, "Sy": 12600.0, "Zx": 62944.0, "Zy": 14112.0 },
            { "name": "I-Beam-125x75", "Ag": 1610.0, "d": 125.0, "tw": 5.5, "bf": 75.0, "tf": 9.5, "Ix": 5380000.0, "Iy": 575000.0, "rx": 51.3, "ry": 16.8, "Sx": 86000.0, "Sy": 15300.0, "Zx": 96320.0, "Zy": 17136.0 },
            { "name": "I-Beam-150x125", "Ag": 3620.0, "d": 150.0, "tw": 8.5, "bf": 125.0, "tf": 14.0, "Ix": 17600000.0, "Iy": 3850000.0, "rx": 61.8, "ry": 28.9, "Sx": 235000.0, "Sy": 61600.0, "Zx": 263200.0, "Zy": 68992.0 },
            { "name": "I-Beam-150x75", "Ag": 1710.0, "d": 150.0, "tw": 5.5, "bf": 75.0, "tf": 9.5, "Ix": 8190000.0, "Iy": 575000.0, "rx": 61.2, "ry": 16.2, "Sx": 109000.0, "Sy": 15300.0, "Zx": 122080.0, "Zy": 17136.0 },
            { "name": "I-Beam-180x100", "Ag": 2360.0, "d": 180.0, "tw": 6.0, "bf": 100.0, "tf": 10.0, "Ix": 16700000.0, "Iy": 1380000.0, "rx": 74.5, "ry": 21.4, "Sx": 186000.0, "Sy": 27500.0, "Zx": 208320.0, "Zy": 30800.0 },
            { "name": "I-Beam-200x100", "Ag": 2640.0, "d": 200.0, "tw": 6.0, "bf": 100.0, "tf": 11.0, "Ix": 21500000.0, "Iy": 1380000.0, "rx": 80.5, "ry": 20.3, "Sx": 215000.0, "Sy": 27500.0, "Zx": 240800.0, "Zy": 30800.0 },
            { "name": "I-Beam-200x150", "Ag": 5240.0, "d": 200.0, "tw": 9.0, "bf": 150.0, "tf": 16.0, "Ix": 39600000.0, "Iy": 6870000.0, "rx": 76.4, "ry": 31.9, "Sx": 396000.0, "Sy": 91600.0, "Zx": 443520.0, "Zy": 102592.0 },
            { "name": "I-Beam-250x125", "Ag": 4000.0, "d": 250.0, "tw": 7.5, "bf": 125.0, "tf": 12.5, "Ix": 49400000.0, "Iy": 3460000.0, "rx": 99.4, "ry": 26.0, "Sx": 395000.0, "Sy": 55400.0, "Zx": 442400.0, "Zy": 62048.0 },
            { "name": "I-Beam-250x175", "Ag": 7160.0, "d": 250.0, "tw": 11.0, "bf": 175.0, "tf": 18.0, "Ix": 78800000.0, "Iy": 12700000.0, "rx": 94.7, "ry": 37.5, "Sx": 630000.0, "Sy": 145000.0, "Zx": 705600.0, "Zy": 162400.0 },
            { "name": "I-Beam-300x150", "Ag": 5520.0, "d": 300.0, "tw": 9.0, "bf": 150.0, "tf": 14.0, "Ix": 102000000.0, "Iy": 6700000.0, "rx": 121.1, "ry": 31.0, "Sx": 680000.0, "Sy": 89300.0, "Zx": 761600.0, "Zy": 99999.99999999999 },
            { "name": "I-Beam-300x300", "Ag": 11980.0, "d": 300.0, "tw": 10.0, "bf": 300.0, "tf": 15.0, "Ix": 197000000.0, "Iy": 64300000.0, "rx": 128.0, "ry": 73.3, "Sx": 1310000.0, "Sy": 429000.0, "Zx": 1467200.0, "Zy": 480480.0 },
            { "name": "I-Beam-310x175", "Ag": 7740.0, "d": 310.0, "tw": 11.0, "bf": 175.0, "tf": 18.0, "Ix": 122000000.0, "Iy": 12900000.0, "rx": 112.8, "ry": 36.3, "Sx": 785000.0, "Sy": 147000.0, "Zx": 879200.0, "Zy": 164640.0 },
            { "name": "I-Beam-350x175", "Ag": 7220.0, "d": 350.0, "tw": 9.5, "bf": 175.0, "tf": 14.5, "Ix": 158000000.0, "Iy": 10700000.0, "rx": 132.6, "ry": 34.299999999999997, "Sx": 901000.0, "Sy": 122000.0, "Zx": 1009120.0, "Zy": 136640.0 },
            { "name": "I-Beam-390x300", "Ag": 13450.0, "d": 390.0, "tw": 10.0, "bf": 300.0, "tf": 16.0, "Ix": 311000000.0, "Iy": 65300000.0, "rx": 152.0, "ry": 69.7, "Sx": 1590000.0, "Sy": 435000.0, "Zx": 1780800.0, "Zy": 487200.0 },
            { "name": "I-Beam-400x150", "Ag": 6170.0, "d": 400.0, "tw": 9.0, "bf": 150.0, "tf": 14.0, "Ix": 191000000.0, "Iy": 6820000.0, "rx": 157.7, "ry": 29.6, "Sx": 953000.0, "Sy": 90900.0, "Zx": 1067360.0, "Zy": 101808.0 },
            { "name": "I-Beam-400x200", "Ag": 8810.0, "d": 400.0, "tw": 10.5, "bf": 200.0, "tf": 17.0, "Ix": 273000000.0, "Iy": 16700000.0, "rx": 158.2, "ry": 38.799999999999997, "Sx": 1370000.0, "Sy": 167000.0, "Zx": 1534400.0, "Zy": 187040.0 },
            { "name": "I-Beam-440x300", "Ag": 15190.0, "d": 440.0, "tw": 11.0, "bf": 300.0, "tf": 18.0, "Ix": 447000000.0, "Iy": 67300000.0, "rx": 171.5, "ry": 66.6, "Sx": 2030000.0, "Sy": 449000.0, "Zx": 2273600.0, "Zy": 502880.0 },
            { "name": "I-Beam-450x175", "Ag": 8430.0, "d": 450.0, "tw": 10.0, "bf": 175.0, "tf": 15.0, "Ix": 278000000.0, "Iy": 11300000.0, "rx": 162.1, "ry": 32.700000000000003, "Sx": 1230000.0, "Sy": 129000.0, "Zx": 1377600.0, "Zy": 144480.0 },
            { "name": "I-Beam-450x200", "Ag": 9740.0, "d": 450.0, "tw": 11.0, "bf": 200.0, "tf": 18.0, "Ix": 341000000.0, "Iy": 17600000.0, "rx": 167.5, "ry": 37.9, "Sx": 1510000.0, "Sy": 176000.0, "Zx": 1691200.0, "Zy": 197120.0 },
            { "name": "I-Beam-482x300", "Ag": 17480.0, "d": 482.0, "tw": 11.0, "bf": 300.0, "tf": 20.0, "Ix": 576000000.0, "Iy": 68500000.0, "rx": 181.5, "ry": 62.6, "Sx": 2390000.0, "Sy": 457000.0, "Zx": 2676800.0, "Zy": 511840.0 },
            { "name": "I-Beam-500x200", "Ag": 11180.0, "d": 500.0, "tw": 12.0, "bf": 200.0, "tf": 19.0, "Ix": 455000000.0, "Iy": 18800000.0, "rx": 181.3, "ry": 36.5, "Sx": 1820000.0, "Sy": 188000.0, "Zx": 2038400.0, "Zy": 210560.0 },
            { "name": "I-Beam-582x300", "Ag": 17920.0, "d": 582.0, "tw": 12.0, "bf": 300.0, "tf": 17.0, "Ix": 757000000.0, "Iy": 68200000.0, "rx": 205.5, "ry": 61.7, "Sx": 2600000.0, "Sy": 455000.0, "Zx": 2912000.0, "Zy": 509600.0 },
            { "name": "I-Beam-594x302", "Ag": 20800.0, "d": 594.0, "tw": 14.0, "bf": 302.0, "tf": 23.0, "Ix": 959000000.0, "Iy": 82900000.0, "rx": 214.8, "ry": 63.1, "Sx": 3230000.0, "Sy": 549000.0, "Zx": 3617600.0, "Zy": 614880.0 },
            { "name": "I-Beam-600x200", "Ag": 12340.0, "d": 600.0, "tw": 13.0, "bf": 200.0, "tf": 21.0, "Ix": 624000000.0, "Iy": 19900000.0, "rx": 201.7, "ry": 35.8, "Sx": 2080000.0, "Sy": 199000.0, "Zx": 2329600.0, "Zy": 222880.0 },
            { "name": "I-Beam-692x300", "Ag": 20740.0, "d": 692.0, "tw": 13.0, "bf": 300.0, "tf": 20.0, "Ix": 1180000000.0, "Iy": 72000000.0, "rx": 238.6, "ry": 58.9, "Sx": 3420000.0, "Sy": 480000.0, "Zx": 3830400.0, "Zy": 537600.0 },
            { "name": "I-Beam-700x300", "Ag": 23860.0, "d": 700.0, "tw": 15.0, "bf": 300.0, "tf": 24.0, "Ix": 1440000000.0, "Iy": 86600000.0, "rx": 245.5, "ry": 60.3, "Sx": 4110000.0, "Sy": 577000.0, "Zx": 4603200.0, "Zy": 646240.0 },
            { "name": "I-Beam-800x300", "Ag": 24100.0, "d": 808.0, "tw": 16.0, "bf": 302.0, "tf": 30.0, "Ix": 3390000000.0, "Iy": 138000000.0, "rx": 332.0, "ry": 67.0, "Sx": 8400000.0, "Sy": 915000.0, "Zx": 9408000.0, "Zy": 1024800.0 },
            { "name": "I-Beam-900x300", "Ag": 27090.0, "d": 890.0, "tw": 15.0, "bf": 299.0, "tf": 23.0, "Ix": 3450000000.0, "Iy": 103000000.0, "rx": 357.0, "ry": 61.6, "Sx": 7760000.0, "Sy": 688000.0, "Zx": 8691200.0, "Zy": 770560.0 },
            { "name": "I-Beam-900x300", "Ag": 30980.0, "d": 900.0, "tw": 16.0, "bf": 300.0, "tf": 28.0, "Ix": 4110000000.0, "Iy": 126000000.0, "rx": 364.0, "ry": 63.9, "Sx": 9140000.0, "Sy": 843000.0, "Zx": 10236800.0, "Zy": 944160.0 },
            { "name": "WF-100x100", "Ag": 2190.0, "d": 100.0, "tw": 6.0, "bf": 100.0, "tf": 8.0, "Ix": 3460000.0, "Iy": 1340000.0, "rx": 39.8, "ry": 24.8, "Sx": 69200.0, "Sy": 26800.0, "Zx": 77504.0, "Zy": 30016.0 },
            { "name": "WF-125x125", "Ag": 3060.0, "d": 125.0, "tw": 6.5, "bf": 125.0, "tf": 9.0, "Ix": 7910000.0, "Iy": 2690000.0, "rx": 50.8, "ry": 29.6, "Sx": 127000.0, "Sy": 43100.0, "Zx": 142240.0, "Zy": 48272.0 },
            { "name": "WF-150x100", "Ag": 2169.0, "d": 150.0, "tw": 5.5, "bf": 100.0, "tf": 8.0, "Ix": 8910000.0, "Iy": 1520000.0, "rx": 64.1, "ry": 26.5, "Sx": 119000.0, "Sy": 30500.0, "Zx": 133280.0, "Zy": 34160.0 },
            { "name": "WF-150x150", "Ag": 4040.0, "d": 150.0, "tw": 7.0, "bf": 150.0, "tf": 10.0, "Ix": 15800000.0, "Iy": 5260000.0, "rx": 62.5, "ry": 36.1, "Sx": 211000.0, "Sy": 70100.0, "Zx": 236320.0, "Zy": 78512.0 },
            { "name": "WF-175x125", "Ag": 3060.0, "d": 175.0, "tw": 6.0, "bf": 125.0, "tf": 9.0, "Ix": 16200000.0, "Iy": 2730000.0, "rx": 72.8, "ry": 29.9, "Sx": 185000.0, "Sy": 43700.0, "Zx": 207200.0, "Zy": 48944.0 },
            { "name": "WF-200x150", "Ag": 4124.0, "d": 200.0, "tw": 6.0, "bf": 150.0, "tf": 9.0, "Ix": 27600000.0, "Iy": 4950000.0, "rx": 81.8, "ry": 34.6, "Sx": 276000.0, "Sy": 66000.0, "Zx": 309120.0, "Zy": 73920.0 },
            { "name": "WF-200x200", "Ag": 6430.0, "d": 200.0, "tw": 8.0, "bf": 200.0, "tf": 12.0, "Ix": 45500000.0, "Iy": 15400000.0, "rx": 84.1, "ry": 48.9, "Sx": 455000.0, "Sy": 154000.0, "Zx": 509600.0, "Zy": 172480.0 },
            { "name": "WF-250x125", "Ag": 3774.0, "d": 250.0, "tw": 6.0, "bf": 125.0, "tf": 9.0, "Ix": 37800000.0, "Iy": 2880000.0, "rx": 100.1, "ry": 27.6, "Sx": 302000.0, "Sy": 46100.0, "Zx": 338240.0, "Zy": 51632.0 },
            { "name": "WF-250x175", "Ag": 5684.0, "d": 250.0, "tw": 7.0, "bf": 175.0, "tf": 11.0, "Ix": 59900000.0, "Iy": 9120000.0, "rx": 102.7, "ry": 40.0, "Sx": 479000.0, "Sy": 104000.0, "Zx": 536480.0, "Zy": 116480.0 },
            { "name": "WF-250x250", "Ag": 9220.0, "d": 250.0, "tw": 9.0, "bf": 250.0, "tf": 14.0, "Ix": 103000000.0, "Iy": 35100000.0, "rx": 106.0, "ry": 61.7, "Sx": 824000.0, "Sy": 281000.0, "Zx": 922880.0, "Zy": 314720.0 },
            { "name": "WF-300x150", "Ag": 4678.0, "d": 300.0, "tw": 6.5, "bf": 150.0, "tf": 9.0, "Ix": 72100000.0, "Iy": 5080000.0, "rx": 124.1, "ry": 32.9, "Sx": 481000.0, "Sy": 67700.0, "Zx": 538720.0, "Zy": 75824.0 },
            { "name": "WF-300x200", "Ag": 7190.0, "d": 300.0, "tw": 8.0, "bf": 200.0, "tf": 12.0, "Ix": 114000000.0, "Iy": 15400000.0, "rx": 125.8, "ry": 46.3, "Sx": 760000.0, "Sy": 154000.0, "Zx": 851200.0, "Zy": 172480.0 },
            { "name": "WF-300x300", "Ag": 11980.0, "d": 300.0, "tw": 10.0, "bf": 300.0, "tf": 15.0, "Ix": 197000000.0, "Iy": 64300000.0, "rx": 128.0, "ry": 73.3, "Sx": 1310000.0, "Sy": 429000.0, "Zx": 1467200.0, "Zy": 480480.0 },
            { "name": "WF-350x175", "Ag": 6541.0, "d": 350.0, "tw": 7.0, "bf": 175.0, "tf": 11.0, "Ix": 136000000.0, "Iy": 9310000.0, "rx": 144.2, "ry": 37.700000000000003, "Sx": 777000.0, "Sy": 106000.0, "Zx": 870240.0, "Zy": 118720.0 },
            { "name": "WF-350x250", "Ag": 10550.0, "d": 350.0, "tw": 9.0, "bf": 250.0, "tf": 14.0, "Ix": 230000000.0, "Iy": 35300000.0, "rx": 147.6, "ry": 57.8, "Sx": 1310000.0, "Sy": 282000.0, "Zx": 1467200.0, "Zy": 315840.0 },
            { "name": "WF-350x350", "Ag": 17390.0, "d": 350.0, "tw": 12.0, "bf": 350.0, "tf": 19.0, "Ix": 387000000.0, "Iy": 131000000.0, "rx": 149.0, "ry": 86.8, "Sx": 2210000.0, "Sy": 749000.0, "Zx": 2475200.0, "Zy": 838880.0 },
            { "name": "WF-400x200", "Ag": 8410.0, "d": 400.0, "tw": 8.0, "bf": 200.0, "tf": 13.0, "Ix": 205000000.0, "Iy": 15700000.0, "rx": 156.2, "ry": 43.200000000000003, "Sx": 1030000.0, "Sy": 157000.0, "Zx": 1153600.0, "Zy": 175840.0 },
            { "name": "WF-400x300", "Ag": 14000.0, "d": 400.0, "tw": 10.0, "bf": 300.0, "tf": 16.0, "Ix": 364000000.0, "Iy": 64500000.0, "rx": 161.2, "ry": 67.9, "Sx": 1820000.0, "Sy": 430000.0, "Zx": 2038400.0, "Zy": 481600.0 },
            { "name": "WF-400x400", "Ag": 21870.0, "d": 400.0, "tw": 13.0, "bf": 400.0, "tf": 21.0, "Ix": 630000000.0, "Iy": 208000000.0, "rx": 170.0, "ry": 97.5, "Sx": 3150000.0, "Sy": 1040000.0, "Zx": 3528000.0, "Zy": 1164800.0 },
            { "name": "WF-450x200", "Ag": 9550.0, "d": 450.0, "tw": 9.0, "bf": 200.0, "tf": 14.0, "Ix": 294000000.0, "Iy": 16000000.0, "rx": 175.5, "ry": 40.9, "Sx": 1310000.0, "Sy": 160000.0, "Zx": 1467200.0, "Zy": 179200.0 },
            { "name": "WF-450x300", "Ag": 15600.0, "d": 450.0, "tw": 11.0, "bf": 300.0, "tf": 18.0, "Ix": 516000000.0, "Iy": 65600000.0, "rx": 181.8, "ry": 64.8, "Sx": 2290000.0, "Sy": 437000.0, "Zx": 2564800.0, "Zy": 489440.0 },
            { "name": "WF-500x200", "Ag": 10950.0, "d": 500.0, "tw": 10.0, "bf": 200.0, "tf": 16.0, "Ix": 405000000.0, "Iy": 16600000.0, "rx": 192.3, "ry": 38.9, "Sx": 1620000.0, "Sy": 166000.0, "Zx": 1814400.0, "Zy": 185920.0 },
            { "name": "WF-600x200", "Ag": 12550.0, "d": 600.0, "tw": 11.0, "bf": 200.0, "tf": 17.0, "Ix": 606000000.0, "Iy": 17300000.0, "rx": 219.8, "ry": 37.1, "Sx": 2020000.0, "Sy": 173000.0, "Zx": 2262400.0, "Zy": 193760.0 },
            { "name": "WF-800x300", "Ag": 24100.0, "d": 808.0, "tw": 16.0, "bf": 302.0, "tf": 30.0, "Ix": 3390000000.0, "Iy": 138000000.0, "rx": 332.0, "ry": 67.0, "Sx": 8400000.0, "Sy": 915000.0, "Zx": 9408000.0, "Zy": 1024800.0 },
            { "name": "WF-890x299", "Ag": 27090.0, "d": 890.0, "tw": 15.0, "bf": 299.0, "tf": 23.0, "Ix": 3450000000.0, "Iy": 103000000.0, "rx": 357.0, "ry": 61.6, "Sx": 7760000.0, "Sy": 688000.0, "Zx": 8691200.0, "Zy": 770560.0 },
            { "name": "WF-900x300", "Ag": 28600.0, "d": 912.0, "tw": 18.0, "bf": 302.0, "tf": 34.0, "Ix": 4980000000.0, "Iy": 157000000.0, "rx": 370.0, "ry": 65.6, "Sx": 10900000.0, "Sy": 1040000.0, "Zx": 12208000.0, "Zy": 1164800.0 },
            { "name": "WF-900x300", "Ag": 30980.0, "d": 900.0, "tw": 16.0, "bf": 300.0, "tf": 28.0, "Ix": 4110000000.0, "Iy": 126000000.0, "rx": 364.0, "ry": 63.9, "Sx": 9140000.0, "Sy": 843000.0, "Zx": 10236800.0, "Zy": 944160.0 }
        ]; // End of steelSectionsDatabase array

        // --- Populate Section Dropdown ---
        const sectionSelect = document.getElementById('section');
        steelSectionsDatabase.forEach(sec => {
            const option = document.createElement('option');
            // Use the 'name' which now includes the type prefix
            option.value = sec.name;
            option.textContent = sec.name;
            sectionSelect.appendChild(option);
        });

        // --- Helper Function to Get Section Properties ---
        function getSectionProperties(sectionName) {
            // Find based on the combined name (e.g., "WF-300x300")
            return steelSectionsDatabase.find(sec => sec.name === sectionName);
        }

        // --- Format Number Helper ---
        function formatNum(num, digits = 2) {
            if (typeof num !== 'number' || isNaN(num) || num === null) return "-";
             // Basic check for very large/small numbers for scientific notation
             if (Math.abs(num) > 1e9 || (Math.abs(num) < 1e-3 && num !== 0)) {
                 return num.toExponential(digits);
             }
            return num.toFixed(digits);
        }

        // --- Calculation Function ---
        function calculateDesign() {
            const outputDiv = document.getElementById('output');
            const resultsDiv = document.getElementById('results');
            outputDiv.innerHTML = ""; // Clear previous results
            resultsDiv.classList.add('hidden'); // Hide results initially

            try {
                // --- Get Input Values and Convert Units ---
                const Fy = parseFloat(document.getElementById('fy').value); // MPa
                const E = parseFloat(document.getElementById('E').value);   // MPa
                const L_m = parseFloat(document.getElementById('length').value); // m
                const L_mm = L_m * 1000; // mm
                const Kx = parseFloat(document.getElementById('Kx').value);
                const Ky = parseFloat(document.getElementById('Ky').value);
                const Pu_kN = parseFloat(document.getElementById('Pu').value); // kN
                const Pu_N = Pu_kN * 1000; // N
                const Mux_kNm = parseFloat(document.getElementById('Mux').value); // kN.m
                const Mux_Nmm = Mux_kNm * 1e6; // N.mm
                const Muy_kNm = parseFloat(document.getElementById('Muy').value); // kN.m
                const Muy_Nmm = Muy_kNm * 1e6; // N.mm
                const Vux_kN = parseFloat(document.getElementById('Vux').value); // kN (Shear causing Mux)
                const Vux_N = Vux_kN * 1000; // N
                const Vuy_kN = parseFloat(document.getElementById('Vuy').value); // kN (Shear causing Muy)
                const Vuy_N = Vuy_kN * 1000; // N
                const selectedSectionName = document.getElementById('section').value;

                // --- Basic Input Validation ---
                 if (isNaN(Fy) || Fy <= 0 || isNaN(E) || E <= 0 || isNaN(L_m) || L_m < 0 || isNaN(Kx) || Kx <= 0 || isNaN(Ky) || Ky <= 0 || isNaN(Pu_kN) || isNaN(Mux_kNm) || isNaN(Muy_kNm) || isNaN(Vux_kN) || isNaN(Vuy_kN) ) {
                    throw new Error("กรุณาป้อนข้อมูลนำเข้าที่เป็นตัวเลขให้ถูกต้อง");
                }

                // --- Get Section Properties ---
                const section = getSectionProperties(selectedSectionName);
                if (!section) throw new Error(`ไม่พบข้อมูลหน้าตัดเหล็ก: ${selectedSectionName}`);

                // Destructure properties, handling potential nulls from JSON conversion of NaN
                const { name, Ag, d, tw, bf, tf, Ix, Iy, Zx, Zy, Sx, Sy, rx, ry } = section;
                const sectionType = name.split('-')[0]; // Get 'WF', 'I-Beam', or 'Channel'

                 // Check if essential properties are valid numbers
                 const essentialProps = { Ag, d, tw, bf, tf, Ix, Iy, rx, ry, Sx, Sy, Zx, Zy };
                 for (const propName in essentialProps) {
                     if (essentialProps[propName] === null || isNaN(essentialProps[propName])) {
                        throw new Error(`คุณสมบัติ '${propName}' ของหน้าตัด ${name} ไม่ถูกต้องหรือหายไปในฐานข้อมูล`);
                     }
                 }


                // Approximate h (clear web depth)
                const h = d - 2 * tf; // Approximation, actual h = d - 2*k_design

                // --- Resistance Factors (LRFD) ---
                const phi_c = 0.90; // Compression
                const phi_b = 0.90; // Flexure
                const phi_v = 0.90; // Shear (assuming non-slender web, AISC G1)

                let resultsHTML = `<p><strong>หน้าตัดที่เลือก:</strong> <span class="result-value">${name}</span></p>`;
                resultsHTML += `<p><strong>คุณสมบัติหน้าตัด (จากไฟล์, หน่วย mm):</strong> Ag=${formatNum(Ag)}, d=${formatNum(d)}, tw=${formatNum(tw)}, bf=${formatNum(bf)}, tf=${formatNum(tf)}, h≈${formatNum(h)}, Zx=${formatNum(Zx/1000)}x10³, Zy=${formatNum(Zy/1000)}x10³, Sx=${formatNum(Sx/1000)}x10³, Sy=${formatNum(Sy/1000)}x10³, rx=${formatNum(rx)}, ry=${formatNum(ry)}</p>`;
                 if (sectionType === 'WF' || sectionType === 'I-Beam') {
                     resultsHTML += `<p class="text-sm text-amber-700">หมายเหตุ: Zx, Zy สำหรับ WF/I-Beam ประมาณจาก 1.12 * Sx, 1.12 * Sy</p>`;
                 } else if (sectionType === 'Channel') {
                     resultsHTML += `<p class="text-sm text-amber-700">หมายเหตุ: Zx, Zy สำหรับ Channel ถูกตั้งค่าเท่ากับ Sx, Sy (Mn จะคำนวณจาก My)</p>`;
                 }

                // --- 1. Local Buckling Check (AISC B4.1b) ---
                resultsHTML += `<div class="result-subsection"><h3 class="font-semibold text-gray-700">1. การโก่งเดาะเฉพาะที่ (Local Buckling Classification - AISC B4.1b)</h3>`;
                const E_over_Fy_sqrt = Math.sqrt(E / Fy);
                 let flangeClass = "", webClass = "";
                 let lambda_f = NaN, lambda_pf = NaN, lambda_rf = NaN;
                 let lambda_w = NaN, lambda_pw = NaN, lambda_rw_comp = NaN; // lambda_rw for compression

                 if (tf > 0 && tw > 0) { // Avoid division by zero
                     // Flange Classification (Simplified - check specific rules for Channels if needed)
                     lambda_f = (sectionType === 'Channel') ? bf / tf : bf / (2 * tf); // Unstiffened element width
                     lambda_pf = 0.38 * E_over_Fy_sqrt;
                     lambda_rf = (sectionType === 'Channel') ? 0.83 * E_over_Fy_sqrt : 1.0 * E_over_Fy_sqrt; // Different lambda_rf for channel flange in flexure (AISC F3.2) - Approximation using compression limit as conservative check here. Full check needed.
                     if (lambda_f <= lambda_pf) flangeClass = "Compact";
                     else if (lambda_f <= lambda_rf) flangeClass = "Non-compact";
                     else flangeClass = "Slender";
                     resultsHTML += `<p>ปีก (Flange): λf = ${formatNum(lambda_f)}, λpf = ${formatNum(lambda_pf)}, λrf ≈ ${formatNum(lambda_rf)} -> <span class="result-value">${flangeClass}</span></p>`;

                     // Web Classification (Stiffened element - using compression limit primarily)
                     lambda_w = h / tw;
                     lambda_pw = 1.49 * E_over_Fy_sqrt; // For uniform compression AISC B4.1b Case 10
                     // lambda_pw_flex = 3.76 * E_over_Fy_sqrt; // For flexure AISC B4.1b Case 15
                     lambda_rw_comp = 2.0 * E_over_Fy_sqrt; // Not used directly in Pn check here but relevant

                     if (lambda_w <= lambda_pw) webClass = "Compact";
                     else webClass = "Non-compact/Slender"; // Simplified beyond compact for web in compression
                     resultsHTML += `<p>เอว (Web): λw = ${formatNum(lambda_w)}, λpw (สำหรับแรงอัด) = ${formatNum(lambda_pw)} -> <span class="result-value">${webClass}</span> (พิจารณาสำหรับแรงอัด)</p>`;

                     if (flangeClass === "Slender" || webClass === "Non-compact/Slender") {
                          resultsHTML += `<p class="warning">คำเตือน: หน้าตัดจัดเป็น Non-compact/Slender การคำนวณกำลังรับแรงอัด (Pn) และแรงดัด (Mn) ด้านล่างยังไม่ได้ลดค่าตาม AISC E7/F2-F13</p>`;
                     }
                     if (sectionType === 'Channel') {
                          resultsHTML += `<p class="warning">คำเตือน: การใช้สูตร AISC B4 สำหรับ I-shape กับ Channel อาจไม่ถูกต้องนัก โดยเฉพาะ λrf ควรตรวจสอบตาม AISC F3</p>`;
                     }
                 } else {
                      resultsHTML += `<p class="error">ไม่สามารถตรวจสอบ Local Buckling ได้เนื่องจาก tf หรือ tw ไม่ถูกต้อง</p>`;
                 }
                resultsHTML += `</div>`;


                // --- 2. Axial Compression Strength (AISC E3/E4) ---
                resultsHTML += `<div class="result-subsection"><h3 class="font-semibold text-gray-700">2. กำลังรับแรงอัดตามแนวแกน (Axial Strength - AISC E)</h3>`;
                const KLx = Kx * L_mm;
                const KLy = Ky * L_mm;
                if (rx <= 0 || ry <= 0) throw new Error("รัศมีไจเรชันต้องมากกว่า 0");
                const slendernessX = KLx / rx;
                const slendernessY = KLy / ry;
                const slenderness = Math.max(slendernessX, slendernessY);
                resultsHTML += `<p>KL/r (แกน X) = ${formatNum(slendernessX)}, KL/r (แกน Y) = ${formatNum(slendernessY)} -> ควบคุมโดย <span class="result-value">${formatNum(slenderness)}</span></p>`;

                let Pn_N = 0, Fcr = 0;
                 if (slenderness > 200) { // AISC E2 recommendation limit
                     resultsHTML += `<p class="warning">คำเตือน: อัตราส่วนความชะลูด KL/r = ${formatNum(slenderness)} > 200</p>`;
                 }
                 if (slenderness > 0) {
                    const Fe = (Math.PI**2 * E) / (slenderness**2); // MPa
                    const slendernessLimitRatio = 4.71 * Math.sqrt(E / Fy);
                    if (slenderness <= slendernessLimitRatio) { // Inelastic Buckling
                        Fcr = (0.658**(Fy / Fe)) * Fy;
                    } else { // Elastic Buckling
                        Fcr = 0.877 * Fe;
                    }
                    // Note: This doesn't account for slender element reduction (AISC E7)
                    Pn_N = Fcr * Ag; // N
                    resultsHTML += `<p>Fe = ${formatNum(Fe)} MPa, 4.71√(E/Fy) = ${formatNum(slendernessLimitRatio)}, Fcr = ${formatNum(Fcr)} MPa</p>`;
                } else { // Zero slenderness (theoretically Pn = Fy*Ag)
                    Fcr = Fy;
                    Pn_N = Fy * Ag;
                    resultsHTML += `<p>อัตราส่วนความชะลูดเป็น 0, ใช้ Fcr = Fy = ${formatNum(Fy)} MPa</p>`;
                }
                 if (flangeClass === "Slender" || webClass === "Non-compact/Slender") {
                     // Add warning again here as Pn is directly affected
                     resultsHTML += `<p class="warning">Pn คำนวณโดยไม่รวมผลลดทอนจากหน้าตัด Slender (AISC E7)</p>`;
                 }

                const phiPn_N = phi_c * Pn_N; // N
                const phiPn_kN = phiPn_N / 1000; // kN
                const axialRatio = Pu_N / phiPn_N; // Pr/Pc for interaction

                resultsHTML += `<p>กำลังรับแรงอัดประลัย (Pn): ${formatNum(Pn_N / 1000)} kN</p>`;
                resultsHTML += `<p>กำลังรับแรงอัดออกแบบ (ΦcPn): <span class="result-value">${formatNum(phiPn_kN)} kN</span></p>`;
                resultsHTML += `<p>แรงอัดที่ต้องการ (Pu): ${formatNum(Pu_kN)} kN</p>`;
                resultsHTML += `<p>อัตราส่วนแรงอัด (Pu / ΦcPn): <span class="result-value">${formatNum(axialRatio, 3)}</span> ${axialRatio <= 1.0 ? '<span class="success">(ผ่าน)</span>' : '<span class="error">(ไม่ผ่าน)</span>'}</p>`;
                resultsHTML += `</div>`;

                // --- 3. Flexural Strength ---
                 resultsHTML += `<div class="result-subsection"><h3 class="font-semibold text-gray-700">3. กำลังรับโมเมนต์ดัด (Flexural Strength - AISC F - ข้อจำกัดสูง)</h3>`;
                 let phiMnx_Nmm = 0, phiMny_Nmm = 0;
                 let flexWarningX = '<span class="warning">(สมมติ Compact, Lb=0, Z≈1.12S)</span>';
                 let flexWarningY = '<span class="warning">(สมมติ Compact, Z≈1.12S)</span>';

                 if (sectionType === 'Channel') {
                      // Base Mn on My (since Z=S was set)
                      phiMnx_Nmm = phi_b * Fy * Sx;
                      phiMny_Nmm = phi_b * Fy * Sy;
                      flexWarningX = '<span class="warning">(Mn อิงตาม My, Lb=0)</span>';
                      flexWarningY = '<span class="warning">(Mn อิงตาม My)</span>';
                      resultsHTML += `<p class="warning">คำเตือน: กำลังรับโมเมนต์ดัดสำหรับ Channel คำนวณจาก My=Fy*S (Z ถูกตั้งค่า=S)</p>`;
                 } else { // WF or I-Beam
                      // Base Mn on Mp (using approximated Z)
                      phiMnx_Nmm = phi_b * Fy * Zx; // Assumes Compact & Lb=0
                      phiMny_Nmm = phi_b * Fy * Zy; // Assumes Compact
                      resultsHTML += `<p class="warning">คำเตือน: กำลังรับโมเมนต์ดัดสำหรับ WF/I-Beam คำนวณจาก Mp=Fy*Z โดย Z ประมาณจาก 1.12*S และไม่คิด LTB</p>`;
                 }
                 // Add warning if section is not compact
                  if (flangeClass !== "Compact" || webClass !== "Compact") {
                        const nonCompactWarning = '<span class="warning">(ไม่รวมผลลดทอน Non-compact/Slender)</span>';
                        flexWarningX += " " + nonCompactWarning;
                        flexWarningY += " " + nonCompactWarning;
                  }


                 const phiMnx_kNm = phiMnx_Nmm / 1e6;
                 const flexRatioX = Mux_Nmm / phiMnx_Nmm;
                 resultsHTML += `<p>แกน X: </p>`;
                 resultsHTML += `<p class="ml-4">กำลังรับโมเมนต์ดัดออกแบบ (ΦbMnx): <span class="result-value">${formatNum(phiMnx_kNm)} kN·m</span> ${flexWarningX}</p>`;
                 resultsHTML += `<p class="ml-4">โมเมนต์ดัดที่ต้องการ (Mux): ${formatNum(Mux_kNm)} kN·m</p>`;
                 resultsHTML += `<p class="ml-4">อัตราส่วนโมเมนต์ดัด X (Mux / ΦbMnx): <span class="result-value">${formatNum(flexRatioX, 3)}</span> ${flexRatioX <= 1.0 ? '<span class="success">(ผ่าน)</span>' : '<span class="error">(ไม่ผ่าน)</span>'}</p>`;

                 const phiMny_kNm = phiMny_Nmm / 1e6;
                 const flexRatioY = Muy_Nmm / phiMny_Nmm;
                 resultsHTML += `<p class="mt-2">แกน Y: </p>`;
                 resultsHTML += `<p class="ml-4">กำลังรับโมเมนต์ดัดออกแบบ (ΦbMny): <span class="result-value">${formatNum(phiMny_kNm)} kN·m</span> ${flexWarningY}</p>`;
                 resultsHTML += `<p class="ml-4">โมเมนต์ดัดที่ต้องการ (Muy): ${formatNum(Muy_kNm)} kN·m</p>`;
                 resultsHTML += `<p class="ml-4">อัตราส่วนโมเมนต์ดัด Y (Muy / ΦbMny): <span class="result-value">${formatNum(flexRatioY, 3)}</span> ${flexRatioY <= 1.0 ? '<span class="success">(ผ่าน)</span>' : '<span class="error">(ไม่ผ่าน)</span>'}</p>`;
                 resultsHTML += `</div>`;


                // --- 4. Shear Strength (AISC G2 - Simplified: Cv=1.0) ---
                resultsHTML += `<div class="result-subsection"><h3 class="font-semibold text-gray-700">4. กำลังรับแรงเฉือน (Shear Strength - AISC G - สมมติ Cv=1.0)</h3>`;
                // แกน Y (Vux acting on web height d)
                const Aw_x = d * tw; // Area resisting Vux
                const Vnx_N = 0.6 * Fy * Aw_x * 1.0; // Assuming Cv=1.0
                const phiVnx_N = phi_v * Vnx_N;
                const phiVnx_kN = phiVnx_N / 1000;
                const shearRatioX = Vux_N / phiVnx_N;
                resultsHTML += `<p>แกน Y (Vux): Aw ≈ ${formatNum(Aw_x)} mm², Vn ≈ ${formatNum(Vnx_N/1000)} kN</p>`;
                resultsHTML += `<p>กำลังรับแรงเฉือนออกแบบ (ΦvVnx): <span class="result-value">${formatNum(phiVnx_kN)} kN</span> <span class="warning">(สมมติ Cv=1.0)</span></p>`;
                resultsHTML += `<p>แรงเฉือนที่ต้องการ (Vux): ${formatNum(Vux_kN)} kN</p>`;
                resultsHTML += `<p>อัตราส่วนแรงเฉือน Y (Vux / ΦvVnx): <span class="result-value">${formatNum(shearRatioX, 3)}</span> ${shearRatioX <= 1.0 ? '<span class="success">(ผ่าน)</span>' : '<span class="error">(ไม่ผ่าน)</span>'}</p>`;

                 // แกน X (Vuy acting on flanges - simplified)
                 const Aw_y = 2 * bf * tf; // Simplified: Area resisting Vuy ≈ 2 * bf * tf
                 const Vny_N = 0.6 * Fy * Aw_y * 1.0; // Highly simplified, Cv=1 assumption less valid
                 const phiVny_N = phi_v * Vny_N;
                 const phiVny_kN = phiVny_N / 1000;
                 const shearRatioY = Vuy_N / phiVny_N;
                 resultsHTML += `<p class="mt-2">แกน X (Vuy): Aw (ปีก) ≈ ${formatNum(Aw_y)} mm², Vn ≈ ${formatNum(Vny_N/1000)} kN</p>`;
                 resultsHTML += `<p>กำลังรับแรงเฉือนออกแบบ (ΦvVny): <span class="result-value">${formatNum(phiVny_kN)} kN</span> <span class="warning">(คำนวณอย่างง่าย)</span></p>`;
                 resultsHTML += `<p>แรงเฉือนที่ต้องการ (Vuy): ${formatNum(Vuy_kN)} kN</p>`;
                 resultsHTML += `<p>อัตราส่วนแรงเฉือน X (Vuy / ΦvVny): <span class="result-value">${formatNum(shearRatioY, 3)}</span> ${shearRatioY <= 1.0 ? '<span class="success">(ผ่าน)</span>' : '<span class="error">(ไม่ผ่าน)</span>'}</p>`;
                 resultsHTML += `</div>`;


                // --- 5. Combined Axial and Flexure Check (AISC H1.1) ---
                resultsHTML += `<div class="result-subsection"><h3 class="font-semibold text-gray-700">5. การตรวจสอบแรงร่วม (Combined Axial and Flexure - AISC H1.1)</h3>`;
                let interactionValue = Infinity;
                let interactionEq = "";
                // Use calculated design strengths (Pc = phiPn_N, Mcx = phiMnx_Nmm, Mcy = phiMny_Nmm)
                // Use required forces (Pr = Pu_N, Mrx = Mux_Nmm, Mry = Muy_Nmm)
                const Pr = Pu_N;
                const Pc = phiPn_N;
                const Mrx = Mux_Nmm;
                const Mry = Muy_Nmm;
                const Mcx = phiMnx_Nmm;
                const Mcy = phiMny_Nmm;

                if (Pc <= 0 || Mcx <= 0 || Mcy <= 0) {
                     resultsHTML += `<p class="error">ไม่สามารถคำนวณ Interaction ได้เนื่องจากกำลังออกแบบเป็นศูนย์หรือติดลบ</p>`;
                } else {
                    const ratio_Pr_Pc = Pr / Pc;
                    resultsHTML += `<p>Pr/Pc = ${formatNum(ratio_Pr_Pc, 3)}</p>`;

                    if (ratio_Pr_Pc >= 0.2) {
                        // Eq. H1-1a
                        interactionValue = ratio_Pr_Pc + (8/9) * ( (Mrx / Mcx) + (Mry / Mcy) );
                        interactionEq = "H1-1a";
                    } else {
                        // Eq. H1-1b
                        interactionValue = ratio_Pr_Pc / 2 + ( (Mrx / Mcx) + (Mry / Mcy) );
                         interactionEq = "H1-1b";
                    }
                     resultsHTML += `<p>สมการควบคุม: ${interactionEq}</p>`;
                     resultsHTML += `<p>ค่า Interaction: <span class="result-value">${formatNum(interactionValue, 3)}</span></p>`;
                     resultsHTML += `<p>ผลการตรวจสอบ: ${interactionValue <= 1.0 ? '<span class="success">ผ่าน (≤ 1.0)</span>' : '<span class="error">ไม่ผ่าน (> 1.0)</span>'}</p>`;
                }
                 resultsHTML += `</div>`;

                // --- Final Summary ---
                 resultsHTML += `<div class="result-subsection"><h3 class="font-semibold text-gray-700">6. สรุปผลการตรวจสอบเบื้องต้น</h3>`;
                 const overallPass = axialRatio <= 1.0 && flexRatioX <= 1.0 && flexRatioY <= 1.0 && shearRatioX <= 1.0 && shearRatioY <= 1.0 && interactionValue <= 1.0;
                 resultsHTML += `<p>สถานะโดยรวม: ${overallPass ? '<span class="success result-value">ผ่าน</span>' : '<span class="error result-value">ไม่ผ่าน</span>'} (ภายใต้ข้อจำกัดและสมมติฐานที่ระบุ)</p>`;
                 resultsHTML += `</div>`;


                // Display results
                outputDiv.innerHTML = resultsHTML;
                resultsDiv.classList.remove('hidden');

            } catch (error) {
                 console.error("Calculation Error:", error);
                 outputDiv.innerHTML = `<p class="error">เกิดข้อผิดพลาดในการคำนวณ: ${error.message}</p>`;
                 resultsDiv.classList.remove('hidden');
            }
        }

         // Initial population of dropdown
         // Consider adding a default selection or prompt
         // window.onload = () => { /* Potentially select a default */ };

    </script>

</body>
</html>

